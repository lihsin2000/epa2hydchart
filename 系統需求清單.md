# epa2HydChart 系統需求清單

## 專案資訊
- **專案名稱**: epa2HydChart
- **專案描述**: EPANET成果自動繪圖程式
- **當前版本**: 0.1.0.4 (測試版)
- **開發語言**: Python 3.11.9

---

## 一、硬體需求

### 最低需求
- **處理器**: Intel Core i3 或同等級處理器
- **記憶體**: 4 GB RAM
- **硬碟空間**: 500 MB 可用空間
- **顯示器**: 1280x720 解析度

### 建議需求
- **處理器**: Intel Core i5 或更高
- **記憶體**: 8 GB RAM 或更高
- **硬碟空間**: 1 GB 可用空間
- **顯示器**: 1920x1080 解析度或更高

---

## 二、軟體需求

### 作業系統
- **支援系統**: Windows 10/11 (64-bit)
- **測試環境**: Windows 11

### 必要軟體元件

#### 1. Python 執行環境
- **版本**: Python 3.11.9
- **用途**: 程式執行基礎環境

#### 2. GTK+ for Windows Runtime Environment
- **版本**: 3.24.31-2022-01-04-ts-win64
- **下載位置**: https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer/releases/download/2022-01-04/gtk3-runtime-3.24.31-2022-01-04-ts-win64.exe
- **用途**: 支援 cairosvg 進行 SVG 轉 PNG 功能
- **必要性**: 必須安裝

#### 3. EPANET
- **版本**: EPANET 2.2
- **用途**: 產生輸入檔(.inp)和報告檔(.rpt)
- **必要性**: 必須安裝（用於前置資料準備）

---

## 三、Python 套件依賴

### 核心套件 (requirements.txt)
```
ezdxf==1.3.4          # DXF 檔案格式處理
pandas==2.2.3         # 資料處理與分析
PyQt6==6.4.2          # GUI 圖形介面框架
PyQt6-tools           # PyQt6 開發工具
cairosvg==2.7.1       # SVG 向量圖轉 PNG 點陣圖
pyinstaller==6.10.0   # 程式打包成可執行檔
```

### 套件用途說明

| 套件名稱 | 版本 | 用途 |
|---------|------|------|
| ezdxf | 1.3.4 | 處理 AutoCAD DXF 檔案格式的讀寫 |
| pandas | 2.2.3 | 處理 EPANET 資料的結構化分析 |
| PyQt6 | 6.4.2 | 建立圖形使用者介面 (GUI) |
| PyQt6-tools | - | PyQt6 的開發與設計工具 |
| cairosvg | 2.7.1 | 將 SVG 向量圖轉換為 PNG 點陣圖 |
| pyinstaller | 6.10.0 | 將 Python 程式打包成獨立執行檔 |

---

## 四、功能需求

### 主要功能
1. **檔案讀取功能**
   - 讀取 EPANET .inp 檔案（輸入檔）
   - 讀取 EPANET .rpt 檔案（輸出檔）
   - 支援檔案瀏覽器選擇檔案

2. **繪圖功能**
   - 自動生成水力分析圖
   - 支援圖塊類型：
     - Tank (水池)
     - Reservoir (接水點)
     - Pump (抽水機)
     - Valve (閥件)
     - Junction (節點)
   - 自動加上引線及節點標示
   - 自動判斷水流方向並調整標示箭頭

3. **參數調整功能**
   - 節點圖塊大小調整
   - 其他圖塊大小調整
   - 文字大小調整
   - 引線偏移距離調整
   - 線寬調整
   - 小數位數設定

4. **多時段支援**
   - 選擇特定時段匯出
   - 多時段成果自動處理
   - 檔名後綴自動設定為時段名稱

5. **檔案匯出功能**
   - 匯出 DXF 格式（AutoCAD 格式）
   - 同步匯出 SVG 向量圖
   - 同步匯出 PNG 點陣圖（解析度：10000x, DPI 600）

6. **自動計算與標註**
   - 自動計算全系統流量 (Q 值)
   - 自動分析管線 C 值
   - 顯示工程名稱
   - 顯示節點高程 (Elevation)
   - 顯示節點壓力 (Pressure)
   - 顯示管徑、管長、流量、水頭損失

7. **使用者介面功能**
   - 參數重置功能
   - 進度日誌顯示
   - 自動尺寸調整選項
   - 匯出 0 CMD 節點選項

---

## 五、輸入/輸出需求

### 輸入檔案格式
- **.inp 檔案**: EPANET 網路輸入檔
  - 包含節點座標、管線資料、圖塊資訊
  - 由 EPANET 2.2 匯出 (File → Export → Network)

- **.rpt 檔案**: EPANET 分析報告檔
  - 包含水力分析結果（流量、壓力、水頭等）
  - 由 EPANET 2.2 執行分析後匯出 (Report → Full)

### 輸出檔案格式
- **.dxf 檔案**: AutoCAD 圖檔格式
  - 包含完整水力分析圖資
  - 可於 AutoCAD 開啟編輯

- **.svg 檔案**: SVG 向量圖格式
  - 便於網頁顯示與分享
  - 可無損縮放

- **.png 檔案**: PNG 點陣圖格式
  - 高解析度輸出（10000px, 600 DPI）
  - 便於即時討論與簡報使用

---

## 六、效能需求

### 處理能力
- 支援處理大型 EPANET 模型（數百個節點）
- 即時更新繪圖進度日誌
- 流暢的使用者介面回應

### 記憶體使用
- 一般模型：< 500 MB
- 大型模型：< 2 GB

### 處理時間
- 中型模型（100-200 節點）：< 30 秒
- 大型模型（>500 節點）：視複雜度而定

---

## 七、相容性需求

### AutoCAD 相容性
- 輸出 DXF 檔案格式需與 AutoCAD 相容
- 支援 AutoCAD 2013 及以上版本

### EPANET 相容性
- 支援 EPANET 2.2 格式
- 相容於標準 .inp 和 .rpt 檔案結構

### 字體需求
- **中文字體**: Microsoft JhengHei (微軟正黑體)
- **字體檔案**: msjh.ttc (包含於 fonts/ 目錄)
- **用途**: DXF 檔案中的中文文字顯示

---

## 八、使用者介面需求

### GUI 框架
- 使用 PyQt6 建構
- 支援繁體中文介面
- Windows 原生視窗風格

### 介面元件
- 檔案瀏覽按鈕
- 參數輸入欄位（含驗證器）
- 下拉選單（時段選擇、小數位數）
- 核取方塊（選項設定）
- 進度日誌顯示區
- 處理按鈕、重置按鈕

---

## 九、開發與部署需求

### 開發環境
- **IDE**: Visual Studio Code
- **版本控制**: Git
- **遠端儲存庫**: GitHub (https://github.com/lihsin2000/epa2hydchart.git)

### 打包需求
- 使用 PyInstaller 打包成獨立執行檔
- 包含所有必要的 Python 套件和依賴
- 包含字體檔案和圖示檔案

### 圖示資源
- **icon.ico**: Windows 執行檔圖示
- **icon.png**: 程式圖示 (PNG 格式)
- **icon.ai**: 原始設計檔 (Adobe Illustrator)

---

## 十、安全性需求

### 檔案處理安全
- 驗證輸入檔案格式
- 錯誤處理機制（避免程式崩潰）
- 檔案寫入衝突檢測與處理

### 錯誤處理
- 完整的 Exception 處理
- 使用者友善的錯誤訊息
- 詳細的錯誤日誌記錄

---

## 十一、文件需求

### 程式文件
- **readme.md**: 基本說明與安裝指引
- **程式說明.pdf**: 完整使用手冊
- **程式說明.pptx**: 簡報版說明文件
- **changelog.txt**: 版本更新記錄

### 範例檔案
- 提供多種測試案例於 example/ 目錄：
  - NoPattern 案例（無時段變化）
  - MultiPattern 案例（多時段）
  - 真實工程案例
  - 錯誤測試案例

---

## 十二、測試需求

### 測試案例類型
1. **無時段測試** (NoPattern)
   - 基本功能測試
   - 異常壓力測試
   - 尺寸錯誤測試

2. **多時段測試** (MultiPattern)
   - 時段選擇功能
   - 多時段檔名處理
   - 真實案例測試

3. **功能測試**
   - 檔案讀取測試
   - 繪圖功能測試
   - 檔案匯出測試
   - 參數調整測試

### 測試資料
- 測試資料存放於 example/ 目錄
- 包含 .inp 和 .rpt 配對檔案
- 涵蓋正常與異常情況

---

## 十三、維護需求

### 程式碼維護
- 模組化設計：
  - `main.py`: 主程式與 GUI
  - `ui.py`: 介面邏輯
  - `config.py`: 設定參數
  - `utils.py`: 通用工具函式
  - `process_utils.py`: 處理邏輯
  - `read_utils.py`: 檔案讀取
  - `load_button.py`: 按鈕功能
  - `check_utils.py`: 檢查工具

### 版本控制
- 使用 Git 進行版本控制
- 版本號記錄於 version.txt
- 詳細變更記錄於 changelog.txt

---

## 十四、已知限制與注意事項

### 手動修改項目
以下欄位未內建於 EPANET，需要手動修改：
- 水塔容量
- 接水點高程
- 接水點壓力

### 檔案處理限制
- 檔案需由 EPANET 2.2 正確匯出
- 不支援損壞或格式錯誤的檔案
- 輸出檔案如被其他程式佔用需關閉後重試

### 平台限制
- 目前僅支援 Windows 平台
- macOS 和 Linux 需要額外測試與調整

---

## 十五、未來擴充建議

### 功能擴充
- 支援更多 EPANET 元件類型
- 增加自訂圖塊樣式功能
- 提供更多匯出格式選項
- 批次處理多個專案

### 效能優化
- 大型專案處理效能優化
- 記憶體使用優化
- 多執行緒處理支援

### 跨平台支援
- macOS 版本開發
- Linux 版本開發
- 跨平台相容性測試

---

## 附錄

### 相關連結
- **GTK+ Runtime**: https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer
- **專案 GitHub**: https://github.com/lihsin2000/epa2hydchart.git
- **EPANET 官網**: https://www.epa.gov/water-research/epanet

### 技術支援
- 詳見 readme.md 和程式說明.pdf
- 問題回報透過 GitHub Issues

---

**文件版本**: 1.0  
**更新日期**: 2025/10/6  
**對應程式版本**: 0.1.0.4
